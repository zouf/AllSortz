{% extends "base.html" %}

{% block body %}


<script type="text/javascript">
	$(function() {
		$( "input:submit" ).button();
	});
</script>

      <div id="fb-root"></div>
      <script>
        window.fbAsyncInit = function() {
          FB.init({
            appId      : '260788694033894', // App ID
            channelURL	: 'http://www.allsortz.com/handle_fb_login/', // Channel File
            status     : true, // check login status
//            cookie     : true, // enable cookies to allow the server to access the session
            xfbml      : true  // parse XFBML
          });
	  FB.getLoginStatus(function(response) {

			  $('#fbdiv').hide();      
			  if (response.status === 'connected') {
			  var uid = response.authResponse.userID;
			  var accessToken = response.authResponse.accessToken;
			  $.ajax({
type: 'POST',
url: '/handle_fb_login/',
data: {sig:response.authResponse.signedRequest, fbuid:response.authResponse.userID},
});
			  } else {
			  // Subscribe to the event 'auth.authResponseChange' and wait for the user to autenticate
			  FB.Event.subscribe('auth.authResponseChange', function(response) {
				  // nothing more needed than to reload the page
				  window.location.reload();
				  },true);      

			  // now dynamically show the login plugin
			  $('#fbdiv').show();      
			  }
});       		
};
        // Load the SDK Asynchronously
        (function(d){
           var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement('script'); js.id = id; js.async = true;
           js.src = "//connect.facebook.net/en_US/all.js";
           ref.parentNode.insertBefore(js, ref);
         }(document));
      </script>

      <div id="fbdiv" class="fb-login-button" >Login with Facebook</div>
      
      

<div class="content" >
{% if form.errors %}
<p>Your username and password didn't match. Please try again.</p>
{% endif %}

<div class="ui-widget">
<form method="post" action="{% url django.contrib.auth.views.login %}" style="margin-left:300px; padding-top:20px">
{% csrf_token %}
<table>
<tr>
    <td>{{ form.username.label_tag }}</td>
    <td>{{ form.username }}</td>
</tr>
<tr>
    <td>{{ form.password.label_tag }}</td>
    <td>{{ form.password }}</td>
</tr>
</table>

<input type="submit" value="login" style="margin-left:-300px" />
<input type="hidden" name="next" value="{{ next }}" />
</form>
</div>



</div>

{% endblock %}
